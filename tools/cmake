#!/bin/bash

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SOURCE_DIR="$SCRIPT_DIR/../gameserver"
DATA_DIR="$SCRIPT_DIR/../data"
RELEASE_DIR="$SCRIPT_DIR/../release"
DEBUG_DIR="$SCRIPT_DIR/../debug"
ECLIPSE_DIR="$SCRIPT_DIR/../eclipse"

case $1 in
  'all')
    mkdir -p "$RELEASE_DIR"
    pushd "$RELEASE_DIR"
    cmake "$SOURCE_DIR" -DCMAKE_BUILD_TYPE=release
    ln -sf "$DATA_DIR" data
    popd

    mkdir -p "$DEBUG_DIR"
    pushd "$DEBUG_DIR"
    cmake "$SOURCE_DIR" -DCMAKE_BUILD_TYPE=debug
    ln -sf "$DATA_DIR" data
    popd

    mkdir -p "$ECLIPSE_DIR"
    pushd "$ECLIPSE_DIR"
    cmake "$SOURCE_DIR" -G"Eclipse CDT4 - Unix Makefiles" -DCMAKE_BUILD_TYPE=debug -DCMAKE_ECLIPSE_VERSION=4.7.3 -DCMAKE_CXX_COMPILER_ARG1=-std=c++14
    ln -sf "$DATA_DIR" data
    popd
    ;;

  'release')
    mkdir -p "$RELEASE_DIR"
    pushd "$RELEASE_DIR"
    cmake "$SOURCE_DIR" -DCMAKE_BUILD_TYPE=release
    ln -sf "$DATA_DIR" data
    popd
    ;;

  'debug')
    mkdir -p "$DEBUG_DIR"
    pushd "$DEBUG_DIR"
    cmake "$SOURCE_DIR" -DCMAKE_BUILD_TYPE=debug
    ln -sf "$DATA_DIR" data
    popd
    ;;

  'eclipse')
    mkdir -p "$ECLIPSE_DIR"
    pushd "$ECLIPSE_DIR"
    cmake "$SOURCE_DIR" -G"Eclipse CDT4 - Unix Makefiles" -DCMAKE_BUILD_TYPE=debug -DCMAKE_ECLIPSE_VERSION=4.7.3 -DCMAKE_CXX_COMPILER_ARG1=-std=c++14
    ln -sf "$DATA_DIR" data
    popd
    ;;

  'clean')
    rm -rf "$RELEASE_DIR" "$DEBUG_DIR" "$ECLIPSE_DIR"
    ;;

  *)
    echo "Usage: $0 [all | release | debug |eclipse | clean]"
    ;;
esac
